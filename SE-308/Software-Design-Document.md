# 软件设计文档

## 后端

### 技术选型理由

以下讲述了项目技术选型的考虑因素：

1. **安全性**：我们希望程序运行过程中可以保证内存安全与线程安全，降低开发人员心智负担与运行维护成本。
2. **可维护性**：可维护性较好的代码可以让团队中的开发人员更容易理解，提高团队工作效率并减少代码出错的可能。
3. **软件性能**：软件应具有较高的运行速度，支持足够高的并发数量，在高压力下也维持一定的可用性

### 架构设计

### 模块划分

在后端模块划分上主要分为：API 模块，业务逻辑模块，数据库模块，信息搜索模块以及用户验证模块，其内容分别如下：

1. **API 模块**：实现 API 设计中指定的 API，根据 API 请求调用业务逻辑中对应的操作。其部分位于 emtm-web crate 下的 route 模块。
2. **业务逻辑模块**：实现软件中的主要业务逻辑，根据请求进行对应的操作，并将结果返回给用户。位于 emtm-web 下的 control 模块。
3. **数据库模块**：负责数据库结构的定义与数据库数据与程序对象的转换。由 emtm-db crate下的 controller, db_models 和 models 模块组成。
4. **信息搜索模块**：负责对用户发起的搜索请求进行处理，通过索引获得相应内容在数据库中的位置，以返回正确的搜索内容信息。位于emtm-db 下的 search 模块。
5. **用户验证模块**：根据用户上传的验证图片，调用相应的腾讯 AI 平台提供的图像识别接口进行识别，根据识别结果决定验证是否通过。位于 emtm-verify crate 中。

### 软件设计技术

1. **Object-Oriented Programming**: 在项目整体中有较广的使用，例如数据库中的controller，models 和 db_models 模块。虽然我们使用的 Rust 语言许多方面与传统的面向对象语言不同，但仍然可以通过 trait 与 struct 来实现封装、多态等面向对象特性，并借助编译器提供的零开销抽象的特性高效地获得代码复用、易于理解、高扩展性等好处。
2. **设计模式**：
   - *单例模式*：在 emtm-db 的 search模组中应用，定义了全局唯一的 searcher 对象，在第一次使用时进行初始化，使用单例模式的原因是建立信息索引的开销较大，若每次新增信息都进行索引变更将拖慢软件性能，因此使用全局对象来对索引变更的时机进行管理，通过互斥锁与读写锁来保证线程安全。
3. **容器化技术**：通过 Docker 容器来简化服务部署流程，主要位于emtm-server 仓库的 docker-compose.yml 与 Dockerfile 中。